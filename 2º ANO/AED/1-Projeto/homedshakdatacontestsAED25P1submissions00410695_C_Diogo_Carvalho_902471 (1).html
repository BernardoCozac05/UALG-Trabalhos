<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Report of submission 00410695_C_Diogo_Carvalho_90247</title>
<link
rel	="stylesheet"
href	="../../styles/base.css"
type	="text/css">
</head>
<body>
<h2>Report #1</h2>

<table>
<tr>
<th>Submission</th>
<td>
<a href="?inspect+data/contests/AED25P1/submissions/00410695_C_Diogo_Carvalho_90247">00410695_C_Diogo_Carvalho_90247</a>
</td>
</tr>
<tr>
<th>File</th>
<td>
<a href="?inspect+data/contests/AED25P1/submissions/00410695_C_Diogo_Carvalho_90247/Story.java">Story.java</a>
<a href="data/contests/AED25P1/submissions/00410695_C_Diogo_Carvalho_90247/Story.java">[Download]</a>
</td>

<tr><th>Received</td>	<td>Fri Sep 26 11:31:55 +0100 2025</td></tr>
<tr><th>Analyzed</td>	<td>Fri Sep 26 11:31:55 +0100 2025 (0:00:00)</td></tr><tr>
<th>Team</th>
<td>
<a href="?inspect+data/contests/AED25P1/groups/students/Diogo_Carvalho_90247">
Diogo_Carvalho_90247
</a> Login: <code>Diogo_Carvalho_90247</code> Group: students [students]
</td><tr>
<th>Language</th>
<td>
<a href="?inspect+data/contests/AED25P1/languages/Java">
Java
</a>
</td><tr>
<th>Problem</th>
<td>
<a href="?inspect+data/contests/AED25P1/problems/C">
C: Story
</a>
</td><tr>
<th>Compilation</th>
<td></td>
</tr>
</table><p>
<table
border="1"
width="100%">
<tr>
<th>Test</th>
<th>Expected</th>
<th>Obtained</th>
<th>Differences</th>
</tr><tr>
<td valign="top">
<a href="?inspect+/home/dshak/data/contests/AED25P1/problems/C/tests/testC01">
testC01
</a><br>
T=0.088 sec<br>
E=0 sec<br>
M=183976 Kb<br>
<font color="red">Wrong Answer</font><br>
</td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>constructor<font size="-1">[]</font>with<font size="-1">[]</font>errors<font size="-1">\n
</font>IllegalArgumentException<font size="-1">[]</font>launched:<font size="-1">[]</font>true.<font size="-1">\n
</font>IllegalArgumentException<font size="-1">[]</font>launched:<font size="-1">[]</font>true.<font size="-1">\n
</font>IllegalArgumentException<font size="-1">[]</font>launched:<font size="-1">[]</font>true.<font size="-1">\n
</font>IllegalArgumentException<font size="-1">[]</font>launched:<font size="-1">[]</font>true.<font size="-1">\n
</font></pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>constructor<font size="-1">[]</font>with<font size="-1">[]</font>errors<font size="-1">\n
</font>IllegalArgumentException<font size="-1">[]</font>launched:<font size="-1">[]</font>true.<font size="-1">\n
</font>IllegalArgumentException<font size="-1">[]</font>launched:<font size="-1">[]</font>false.<font size="-1">\n
</font>IllegalArgumentException<font size="-1">[]</font>launched:<font size="-1">[]</font>true.<font size="-1">\n
</font>IllegalArgumentException<font size="-1">[]</font>launched:<font size="-1">[]</font>true.<font size="-1">\n
</font></pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>constructor<font size="-1">[]</font>with<font size="-1">[]</font>errors<font size="-1">\n
</font>IllegalArgumentException<font size="-1">[]</font>launched:<font size="-1">[]</font>true.<font size="-1">\n
</font>IllegalArgumentException<font size="-1">[]</font>launched:<font size="-1">[]</font><font color='red'><S>f</S></font><font color='red'><U>true.<font size="-1">\n
</font>Illeg</U></font><font color='red'><S>s</S></font>.<font size="-1">\n
</font>Illegal<font color='red'><U>Argum</U></font>e<font color='red'><U>ntException<font size="-1">[]</font>launched:<font size="-1">[]</font>true</U></font>.<font size="-1">\n
</font>I<font color='red'><S>IllegalArgumentException<font size="-1">[]</font>launched:<font size="-1">[]</font>true.<font size="-1">\n
</font></S></font></pre></td>
</tr><tr>
<td valign="top">
<a href="?inspect+/home/dshak/data/contests/AED25P1/problems/C/tests/testC02">
testC02
</a><br>
T=0.085 sec<br>
E=0 sec<br>
M=183696 Kb<br>
<font color="red">Wrong Answer</font><br>
</td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>constructor<font size="-1">[]</font>and<font size="-1">[]</font>get<font size="-1">[]</font>title/current<font size="-1">\n
</font>Title<font size="-1">\n
</font>[0]<font size="-1">\n
</font>Morreste<font size="-1">\n
</font><FAILED><font size="-1">\n
</font></pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>constructor<font size="-1">[]</font>and<font size="-1">[]</font>get<font size="-1">[]</font>title/current<font size="-1">\n
</font>Unexpected<font size="-1">[]</font>exception:<font size="-1">[]</font>java.lang.IllegalStateException:<font size="-1">[]</font>Cannot<font size="-1">[]</font>access<font size="-1">[]</font>Scene<font size="-1">[]</font>from<font size="-1">[]</font>Node<font size="-1">[]</font>via<font size="-1">[]</font>reflection.<font size="-1">\n
</font></pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>constructor<font size="-1">[]</font>and<font size="-1">[]</font>get<font size="-1">[]</font>title/current<font size="-1">\n
</font><font color='red'><U>T</U></font><font color='red'><S>Un</S></font><font color='red'><U>itl</U></font><font color='red'><S>xp</S></font><font color='red'><U><font size="-1">\n
</font>[0]<font size="-1">\n
</font>Morr</U></font><font color='red'><S>c</S></font>0]<font size="-1">\n
</font>Morre<font color='red'><U>s</U></font><font color='red'><S>d<font size="-1">[]</font>exception:<font size="-1">[]</font>java.lang.</S></font><font color='red'><U><font size="-1">\n
</font><FA</U></font>I<font color='red'><U>L</U></font>ED><font size="-1">\n
</font><font color='red'><S>llegalState</S></font><font color='red'><U>D></U></font><font size="-1">\n
</font><font color='red'><S>xception:<font size="-1">[]</font>Cannot<font size="-1">[]</font>access<font size="-1">[]</font>Scene<font size="-1">[]</font>from<font size="-1">[]</font>Node<font size="-1">[]</font>via<font size="-1">[]</font>reflection.</S></font></pre></td>
</tr><tr>
<td valign="top">
<a href="?inspect+/home/dshak/data/contests/AED25P1/problems/C/tests/testC03">
testC03
</a><br>
T=0.079 sec<br>
E=0 sec<br>
M=183976 Kb<br>
<font color="red">Wrong Answer</font><br>
</td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>parse<font size="-1">[]</font>with<font size="-1">[]</font>problematic<font size="-1">[]</font>files<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font>null<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>number<font size="-1">[]</font>format<font size="-1">[]</font>when<font size="-1">[]</font>parsing!<font size="-1">\n
</font>null<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>number<font size="-1">[]</font>format<font size="-1">[]</font>when<font size="-1">[]</font>parsing!<font size="-1">\n
</font>null<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>number<font size="-1">[]</font>format<font size="-1">[]</font>when<font size="-1">[]</font>parsing!<font size="-1">\n
</font>null<font size="-1">\n
</font></pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>parse<font size="-1">[]</font>with<font size="-1">[]</font>problematic<font size="-1">[]</font>files<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font>null<font size="-1">\n
</font>Error:<font size="-1">[]</font>number<font size="-1">[]</font>format<font size="-1">[]</font>exception<font size="-1">\n
</font>null<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font>null<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font>null<font size="-1">\n
</font></pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>parse<font size="-1">[]</font>with<font size="-1">[]</font>problematic<font size="-1">[]</font>files<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font>null<font size="-1">\n
</font>Error:<font size="-1">[]</font><font color='red'><U>i</U></font>n<font color='red'><U>valid<font size="-1">[]</font>n</U></font>umber<font size="-1">[]</font>format<font size="-1">[]</font><font color='red'><U>wh</U></font><font color='red'><S>xc</S></font>rmat<font size="-1">[]</font>whe<font color='red'><U>n<font size="-1">[]</font>parsing!<font size="-1">\n
</font>null<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>numb</U></font>e<font color='red'><U>r<font size="-1">[]</font>format<font size="-1">[]</font>when<font size="-1">[]</font></U></font>p<font color='red'><U>arsing!<font size="-1">\n
</font>null<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>number<font size="-1">[]</font>forma</U></font>t<font color='red'><U><font size="-1">[]</font>when<font size="-1">[]</font>pars</U></font><font color='red'><S>o</S></font>when<font size="-1">[]</font>parsing!<font size="-1">\n
</font>null<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>number<font size="-1">[]</font>format<font size="-1">[]</font>when<font size="-1">[]</font>parsing!<font size="-1">\n
</font>null<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>number<font size="-1">[]</font>format<font size="-1">[]</font>when<font size="-1">[]</font>parsin<font color='red'><U>g!</U></font><font color='red'><S>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font>null<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font>null<font size="-1">\n
</font></S></font>rsing!<font size="-1">\n
</font>null<font size="-1">\n
</font></pre></td>
</tr><tr>
<td valign="top">
<a href="?inspect+/home/dshak/data/contests/AED25P1/problems/C/tests/testC04">
testC04
</a><br>
T=0.074 sec<br>
E=0 sec<br>
M=184032 Kb<br>
<font color="red">Runtime Error</font><br>
</td>
<td valign="top"><pre><font color="orange"><i>Output demasiado longo: truncado</i></font>
Debug Info: Testing parse with small story
Floresta e Deserto
[0]
A sua aventura - tal como a sua sanidade - chegou a um cruzamento.
A direita, a floresta das Sombras Eternas sussurra segredos que nao
deviam ser ouvidos. A esquerda, o Deserto dos Ossos Quebrados
estala a sua esperanca de qualquer salvacao. Inspire o medo. Expire
a esperanca. Faca a sua escolha.
+ 1. Seguir para a floresta das Sombras Eternas.
+ 2. Seguir para o deserto dos Ossos Quebrados.
Debug Info: Testing parse with large sto...</pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>parse<font size="-1">[]</font>with<font size="-1">[]</font>small<font size="-1">[]</font>story<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font></pre></td>
<td valign="top"><pre><font color="orange"><i>Output demasiado longo: truncado</i></font>
2,16c2
< Floresta e Deserto
< [0]
< A sua aventura - tal como a sua sanidade - chegou a um cruzamento.
< A direita, a floresta das Sombras Eternas sussurra segredos que nao
< deviam ser ouvidos. A esquerda, o Deserto dos Ossos Quebrados
< estala a sua esperanca de qualquer salvacao. Inspire o medo. Expire
< a esperanca. Faca a sua escolha.
< + 1. Seguir para a floresta das Sombras Eternas.
< + 2. Seguir para o deserto dos Ossos Quebrados.
< Debug Info: Testing parse with large story
< The Crown o...</pre></td>
</tr><tr>
<td valign="top">
<a href="?inspect+/home/dshak/data/contests/AED25P1/problems/C/tests/testC05">
testC05
</a><br>
T=0.077 sec<br>
E=0 sec<br>
M=183976 Kb<br>
<font color="red">Runtime Error</font><br>
</td>
<td valign="top"><pre><font color="orange"><i>Output demasiado longo: truncado</i></font>
Debug Info: Testing nonInteractivePlay and reset
WAITING
[0]
A sua aventura - tal como a sua sanidade - chegou a um cruzamento.
A direita, a floresta das Sombras Eternas sussurra segredos que nao
deviam ser ouvidos. A esquerda, o Deserto dos Ossos Quebrados
estala a sua esperanca de qualquer salvacao. Inspire o medo. Expire
a esperanca. Faca a sua escolha.
+ 1. Seguir para a floresta das Sombras Eternas.
+ 2. Seguir para o deserto dos Ossos Quebrados.
FAILED
[2]
Num ultimo espasmo de coragem - ou...</pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>nonInteractivePlay<font size="-1">[]</font>and<font size="-1">[]</font>reset<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font></pre></td>
<td valign="top"><pre><font color="orange"><i>Output demasiado longo: truncado</i></font>
2,48c2
< WAITING
< [0]
< A sua aventura - tal como a sua sanidade - chegou a um cruzamento.
< A direita, a floresta das Sombras Eternas sussurra segredos que nao
< deviam ser ouvidos. A esquerda, o Deserto dos Ossos Quebrados
< estala a sua esperanca de qualquer salvacao. Inspire o medo. Expire
< a esperanca. Faca a sua escolha.
< + 1. Seguir para a floresta das Sombras Eternas.
< + 2. Seguir para o deserto dos Ossos Quebrados.
< FAILED
< [2]
< Num ultimo espasmo de coragem - ou loucura - lanca-s...</pre></td>
</tr><tr>
<td valign="top">
<a href="?inspect+/home/dshak/data/contests/AED25P1/problems/C/tests/testC06">
testC06
</a><br>
T=0.078 sec<br>
E=0 sec<br>
M=183800 Kb<br>
<font color="red">Runtime Error</font><br>
</td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>nonInteractivePlay<font size="-1">\n
</font>FAILED<font size="-1">\n
</font>[16]<font size="-1">\n
</font>As<font size="-1">[]</font>you<font size="-1">[]</font>rest,<font size="-1">[]</font>bandits<font size="-1">[]</font>ambush<font size="-1">[]</font>and<font size="-1">[]</font>overwhelm<font size="-1">[]</font>you.<font size="-1">\n
</font><FAILED><font size="-1">\n
</font>WON<font size="-1">\n
</font>[19]<font size="-1">\n
</font>You<font size="-1">[]</font>claim<font size="-1">[]</font>the<font size="-1">[]</font>Crown<font size="-1">[]</font>of<font size="-1">[]</font>Eternity.<font size="-1">[]</font>Power<font size="-1">[]</font>and<font size="-1">[]</font>glory<font size="-1">[]</font>are<font size="-1">[]</font>yours<font size="-1">[]</font>forever.<font size="-1">\n
</font><WON><font size="-1">\n
</font>WAITING<font size="-1">\n
</font>[8]<font size="-1">\n
</font>You<font size="-1">[]</font>reach<font size="-1">[]</font>a<font size="-1">[]</font>cave<font size="-1">[]</font>entrance<font size="-1">[]</font>carved<font size="-1">[]</font>into<font size="-1">[]</font>the<font size="-1">[]</font>cliffs.<font size="-1">\n
</font>+<font size="-1">[]</font>14.<font size="-1">[]</font>Enter<font size="-1">[]</font>the<font size="-1">[]</font>cave<font size="-1">\n
</font>+<font size="-1">[]</font>16.<font size="-1">[]</font>Rest<font size="-1">[]</font>outside<font size="-1">\n
</font></pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>nonInteractivePlay<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font></pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>nonInteractivePlay<font size="-1">\n
</font><font color='red'><U>FAIL</U></font>E<font color='red'><U>D<font size="-1">\n
</font>[16]<font size="-1">\n
</font>As<font size="-1">[]</font>you<font size="-1">[]</font></U></font>r<font color='red'><U>est,<font size="-1">[]</font>bandits<font size="-1">[]</font>ambush<font size="-1">[]</font>and<font size="-1">[]</font>ove</U></font>r<font color='red'><U>whelm<font size="-1">[]</font>y</U></font>o<font color='red'><U>u.<font size="-1">\n
</font><FAILED><font size="-1">\n
</font>WON<font size="-1">\n
</font>[19]<font size="-1">\n
</font>You<font size="-1">[]</font>claim<font size="-1">[]</font>the<font size="-1">[]</font>C</U></font><font color='red'><S>:</S></font><font size="-1">\n
</font>[16]<font size="-1">\n
</font>As<font size="-1">[]</font>you<font size="-1">[]</font>rest,<font size="-1">[]</font>bandits<font size="-1">[]</font>ambush<font size="-1">[]</font>and<font size="-1">[]</font>overwhelm<font size="-1">[]</font>you.<font size="-1">\n
</font><FAILED><font size="-1">\n
</font>WON<font size="-1">\n
</font>[19]<font size="-1">\n
</font>You<font size="-1">[]</font>claim<font size="-1">[]</font>the<font size="-1">[]</font>Cr<font color='red'><U>own</U></font><font size="-1">[]</font><font color='red'><U>of<font size="-1">[]</font>Etern</U></font>i<font color='red'><U>ty.<font size="-1">[]</font>Power<font size="-1">[]</font>a</U></font>n<font color='red'><U>d<font size="-1">[]</font>glory<font size="-1">[]</font>are<font size="-1">[]</font>yours<font size="-1">[]</font>fore</U></font>v<font color='red'><U>er.<font size="-1">\n
</font><WON><font size="-1">\n
</font>WAITING<font size="-1">\n
</font>[8]<font size="-1">\n
</font>You<font size="-1">[]</font>re</U></font>a<font color='red'><U>ch<font size="-1">[]</font>a<font size="-1">[]</font>cave<font size="-1">[]</font>entrance<font size="-1">[]</font>carved<font size="-1">[]</font>into<font size="-1">[]</font>the<font size="-1">[]</font>c</U></font>li<font color='red'><U>ffs.<font size="-1">\n
</font>+<font size="-1">[]</font>14.<font size="-1">[]</font>Enter<font size="-1">[]</font>the<font size="-1">[]</font>cave<font size="-1">\n
</font>+<font size="-1">[]</font>16.<font size="-1">[]</font>R</U></font><font color='red'><S>d<font size="-1">[]</font>fil</S></font><font size="-1">[]</font>rest,<font size="-1">[]</font>bandits<font size="-1">[]</font>ambush<font size="-1">[]</font>and<font size="-1">[]</font>overwhelm<font size="-1">[]</font>you.<font size="-1">\n
</font><FAILED><font size="-1">\n
</font>WON<font size="-1">\n
</font>[19]<font size="-1">\n
</font>You<font size="-1">[]</font>claim<font size="-1">[]</font>the<font size="-1">[]</font>Crown<font size="-1">[]</font>of<font size="-1">[]</font>Eternity.<font size="-1">[]</font>Power<font size="-1">[]</font>and<font size="-1">[]</font>glory<font size="-1">[]</font>are<font size="-1">[]</font>yours<font size="-1">[]</font>forever.<font size="-1">\n
</font><WON><font size="-1">\n
</font>WAITING<font size="-1">\n
</font>[8]<font size="-1">\n
</font>You<font size="-1">[]</font>reach<font size="-1">[]</font>a<font size="-1">[]</font>cave<font size="-1">[]</font>entrance<font size="-1">[]</font>carved<font size="-1">[]</font>into<font size="-1">[]</font>the<font size="-1">[]</font>cliffs.<font size="-1">\n
</font>+<font size="-1">[]</font>14.<font size="-1">[]</font>Enter<font size="-1">[]</font>the<font size="-1">[]</font>cave<font size="-1">\n
</font>+<font size="-1">[]</font>16.<font size="-1">[]</font>Re<font color='red'><U>st</U></font><font size="-1">[]</font>o<font color='red'><U>uts</U></font><font color='red'><S>r<font size="-1">[]</font>error<font size="-1">[]</font>open</S></font>ambush<font size="-1">[]</font>and<font size="-1">[]</font>overwhelm<font size="-1">[]</font>you.<font size="-1">\n
</font><FAILED><font size="-1">\n
</font>WON<font size="-1">\n
</font>[19]<font size="-1">\n
</font>You<font size="-1">[]</font>claim<font size="-1">[]</font>the<font size="-1">[]</font>Crown<font size="-1">[]</font>of<font size="-1">[]</font>Eternity.<font size="-1">[]</font>Power<font size="-1">[]</font>and<font size="-1">[]</font>glory<font size="-1">[]</font>are<font size="-1">[]</font>yours<font size="-1">[]</font>forever.<font size="-1">\n
</font><WON><font size="-1">\n
</font>WAITING<font size="-1">\n
</font>[8]<font size="-1">\n
</font>You<font size="-1">[]</font>reach<font size="-1">[]</font>a<font size="-1">[]</font>cave<font size="-1">[]</font>entrance<font size="-1">[]</font>carved<font size="-1">[]</font>into<font size="-1">[]</font>the<font size="-1">[]</font>cliffs.<font size="-1">\n
</font>+<font size="-1">[]</font>14.<font size="-1">[]</font>Enter<font size="-1">[]</font>the<font size="-1">[]</font>cave<font size="-1">\n
</font>+<font size="-1">[]</font>16.<font size="-1">[]</font>Rest<font size="-1">[]</font>outsi<font color='red'><U>d</U></font><font color='red'><S>ng<font size="-1">[]</font>fil</S></font>a<font color='red'><S>!</S></font>d<font size="-1">[]</font>overwhelm<font size="-1">[]</font>you.<font size="-1">\n
</font><FAILED><font size="-1">\n
</font>WON<font size="-1">\n
</font>[19]<font size="-1">\n
</font>You<font size="-1">[]</font>claim<font size="-1">[]</font>the<font size="-1">[]</font>Crown<font size="-1">[]</font>of<font size="-1">[]</font>Eternity.<font size="-1">[]</font>Power<font size="-1">[]</font>and<font size="-1">[]</font>glory<font size="-1">[]</font>are<font size="-1">[]</font>yours<font size="-1">[]</font>forever.<font size="-1">\n
</font><WON><font size="-1">\n
</font>WAITING<font size="-1">\n
</font>[8]<font size="-1">\n
</font>You<font size="-1">[]</font>reach<font size="-1">[]</font>a<font size="-1">[]</font>cave<font size="-1">[]</font>entrance<font size="-1">[]</font>carved<font size="-1">[]</font>into<font size="-1">[]</font>the<font size="-1">[]</font>cliffs.<font size="-1">\n
</font>+<font size="-1">[]</font>14.<font size="-1">[]</font>Enter<font size="-1">[]</font>the<font size="-1">[]</font>cave<font size="-1">\n
</font>+<font size="-1">[]</font>16.<font size="-1">[]</font>Rest<font size="-1">[]</font>outside<font size="-1">\n
</font></pre></td>
</tr><tr>
<td valign="top">
<a href="?inspect+/home/dshak/data/contests/AED25P1/problems/C/tests/testC07">
testC07
</a><br>
T=0.097 sec<br>
E=0 sec<br>
M=183988 Kb<br>
<font color="red">Runtime Error</font><br>
</td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>saveStoryState<font size="-1">\n
</font>FAILED<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font>false<font size="-1">\n
</font>Story<font size="-1">[]</font>state<font size="-1">[]</font>saved<font size="-1">[]</font>successfully.<font size="-1">\n
</font>true<font size="-1">\n
</font>Story<font size="-1">[]</font>state<font size="-1">[]</font>saved<font size="-1">[]</font>successfully.<font size="-1">\n
</font>true<font size="-1">\n
</font>Floresta<font size="-1">[]</font>e<font size="-1">[]</font>Deserto<font size="-1">\n
</font>2<font size="-1">\n
</font></pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>saveStoryState<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font></pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>saveStoryState<font size="-1">\n
</font><font color='red'><U>FAIL</U></font>E<font color='red'><U>D<font size="-1">\n
</font>E</U></font>rror:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font><font color='red'><U>false<font size="-1">\n
</font>Story<font size="-1">[]</font>state<font size="-1">[]</font>saved<font size="-1">[]</font>successfully.<font size="-1">\n
</font>true<font size="-1">\n
</font>Story<font size="-1">[]</font>state<font size="-1">[]</font>saved<font size="-1">[]</font>successfully.<font size="-1">\n
</font>true<font size="-1">\n
</font>Floresta<font size="-1">[]</font>e<font size="-1">[]</font>Deserto<font size="-1">\n
</font>2<font size="-1">\n
</font></U></font></pre></td>
</tr><tr>
<td valign="top">
<a href="?inspect+/home/dshak/data/contests/AED25P1/problems/C/tests/testC08">
testC08
</a><br>
T=0.102 sec<br>
E=0 sec<br>
M=183908 Kb<br>
<font color="red">Runtime Error</font><br>
</td>
<td valign="top"><pre><font color="orange"><i>Output demasiado longo: truncado</i></font>
Debug Info: Testing loadStoryState
[0]
A sua aventura - tal como a sua sanidade - chegou a um cruzamento.
A direita, a floresta das Sombras Eternas sussurra segredos que nao
deviam ser ouvidos. A esquerda, o Deserto dos Ossos Quebrados
estala a sua esperanca de qualquer salvacao. Inspire o medo. Expire
a esperanca. Faca a sua escolha.
+ 1. Seguir para a floresta das Sombras Eternas.
+ 2. Seguir para o deserto dos Ossos Quebrados.
Story state loaded successfully.
true
[1]
Atravessa o limiar da flo...</pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>loadStoryState<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font></pre></td>
<td valign="top"><pre><font color="orange"><i>Output demasiado longo: truncado</i></font>
2,20c2
< [0]
< A sua aventura - tal como a sua sanidade - chegou a um cruzamento.
< A direita, a floresta das Sombras Eternas sussurra segredos que nao
< deviam ser ouvidos. A esquerda, o Deserto dos Ossos Quebrados
< estala a sua esperanca de qualquer salvacao. Inspire o medo. Expire
< a esperanca. Faca a sua escolha.
< + 1. Seguir para a floresta das Sombras Eternas.
< + 2. Seguir para o deserto dos Ossos Quebrados.
< Story state loaded successfully.
< true
< [1]
< Atravessa o limiar da florest...</pre></td>
</tr><tr>
<td valign="top">
<a href="?inspect+/home/dshak/data/contests/AED25P1/problems/C/tests/testC09">
testC09
</a><br>
T=0.087 sec<br>
E=0 sec<br>
M=183964 Kb<br>
<font color="red">Runtime Error</font><br>
</td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>loadStoryState<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font>false<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>number<font size="-1">[]</font>format<font size="-1">[]</font>when<font size="-1">[]</font>parsing!<font size="-1">\n
</font>false<font size="-1">\n
</font>The<font size="-1">[]</font>loaded<font size="-1">[]</font>story<font size="-1">[]</font>name<font size="-1">[]</font>does<font size="-1">[]</font>not<font size="-1">[]</font>match.<font size="-1">[]</font>Loading<font size="-1">[]</font>aborted.<font size="-1">\n
</font>false<font size="-1">\n
</font>The<font size="-1">[]</font>scene<font size="-1">[]</font>in<font size="-1">[]</font>the<font size="-1">[]</font>loaded<font size="-1">[]</font>file<font size="-1">[]</font>is<font size="-1">[]</font>not<font size="-1">[]</font>valid.<font size="-1">[]</font>Loading<font size="-1">[]</font>aborted.<font size="-1">\n
</font>false<font size="-1">\n
</font>Story<font size="-1">[]</font>state<font size="-1">[]</font>loaded<font size="-1">[]</font>successfully.<font size="-1">\n
</font>true<font size="-1">\n
</font>[18]<font size="-1">\n
</font>You<font size="-1">[]</font>stand<font size="-1">[]</font>in<font size="-1">[]</font>the<font size="-1">[]</font>castle's<font size="-1">[]</font>throne<font size="-1">[]</font>room.<font size="-1">[]</font>The<font size="-1">[]</font>Crown<font size="-1">[]</font>of<font size="-1">[]</font>Eternity<font size="-1">[]</font>rests<font size="-1">[]</font>before<font size="-1">[]</font>you.<font size="-1">\n
</font>+<font size="-1">[]</font>19.<font size="-1">[]</font>Take<font size="-1">[]</font>the<font size="-1">[]</font>Crown<font size="-1">\n
</font></pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>loadStoryState<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font></pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>loadStoryState<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font><font color='red'><U>false<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>number<font size="-1">[]</font>format<font size="-1">[]</font>when<font size="-1">[]</font>parsing!<font size="-1">\n
</font>false<font size="-1">\n
</font>The<font size="-1">[]</font>loaded<font size="-1">[]</font>story<font size="-1">[]</font>name<font size="-1">[]</font>does<font size="-1">[]</font>not<font size="-1">[]</font>match.<font size="-1">[]</font>Loading<font size="-1">[]</font>aborted.<font size="-1">\n
</font>false<font size="-1">\n
</font>The<font size="-1">[]</font>scene<font size="-1">[]</font>in<font size="-1">[]</font>the<font size="-1">[]</font>loaded<font size="-1">[]</font>file<font size="-1">[]</font>is<font size="-1">[]</font>not<font size="-1">[]</font>valid.<font size="-1">[]</font>Loading<font size="-1">[]</font>aborted.<font size="-1">\n
</font>false<font size="-1">\n
</font>Story<font size="-1">[]</font>state<font size="-1">[]</font>loaded<font size="-1">[]</font>successfully.<font size="-1">\n
</font>true<font size="-1">\n
</font>[18]<font size="-1">\n
</font>You<font size="-1">[]</font>stand<font size="-1">[]</font>in<font size="-1">[]</font>the<font size="-1">[]</font>castle's<font size="-1">[]</font>throne<font size="-1">[]</font>room.<font size="-1">[]</font>The<font size="-1">[]</font>Crown<font size="-1">[]</font>of<font size="-1">[]</font>Eternity<font size="-1">[]</font>rests<font size="-1">[]</font>before<font size="-1">[]</font>you.<font size="-1">\n
</font>+<font size="-1">[]</font>19.<font size="-1">[]</font>Take<font size="-1">[]</font>the<font size="-1">[]</font>Crown<font size="-1">\n
</font></U></font></pre></td>
</tr><tr>
<td valign="top">
<a href="?inspect+/home/dshak/data/contests/AED25P1/problems/C/tests/testC10">
testC10
</a><br>
T=0.079 sec<br>
E=0 sec<br>
M=183876 Kb<br>
<font color="red">Runtime Error</font><br>
</td>
<td valign="top"><pre><font color="orange"><i>Output demasiado longo: truncado</i></font>
Debug Info: Testing interactivePlay
Floresta e Deserto
[0]
A sua aventura - tal como a sua sanidade - chegou a um cruzamento.
A direita, a floresta das Sombras Eternas sussurra segredos que nao
deviam ser ouvidos. A esquerda, o Deserto dos Ossos Quebrados
estala a sua esperanca de qualquer salvacao. Inspire o medo. Expire
a esperanca. Faca a sua escolha.
+ 1. Seguir para a floresta das Sombras Eternas.
+ 2. Seguir para o deserto dos Ossos Quebrados.
Select your option: Invalid option. Please ente...</pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>interactivePlay<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font></pre></td>
<td valign="top"><pre><font color="orange"><i>Output demasiado longo: truncado</i></font>
2,45c2
< Floresta e Deserto
< [0]
< A sua aventura - tal como a sua sanidade - chegou a um cruzamento.
< A direita, a floresta das Sombras Eternas sussurra segredos que nao
< deviam ser ouvidos. A esquerda, o Deserto dos Ossos Quebrados
< estala a sua esperanca de qualquer salvacao. Inspire o medo. Expire
< a esperanca. Faca a sua escolha.
< + 1. Seguir para a floresta das Sombras Eternas.
< + 2. Seguir para o deserto dos Ossos Quebrados.
< Select your option: Invalid option. Please enter a numbe...</pre></td>
</tr><tr>
<td valign="top">
<a href="?inspect+/home/dshak/data/contests/AED25P1/problems/C/tests/testC11">
testC11
</a><br>
T=0.070 sec<br>
E=0 sec<br>
M=183956 Kb<br>
<font color="red">Runtime Error</font><br>
</td>
<td valign="top"><pre><font color="orange"><i>Output demasiado longo: truncado</i></font>
Debug Info: Testing interactivePlay
The Crown of Eternity
[0]
You stand at the edge of the Dark Forest, seeking the Crown of Eternity.
+ 1. Enter the forest
+ 2. Follow the river
Select your option: [2]
You follow the river as it winds deeper into the kingdom.
+ 9. Build a raft
+ 10. Cross a bridge ahead
Select your option: [10]
You find a bridge guarded by a troll demanding passage.
+ 12. Pay with gold
+ 13. Fight the troll
Select your option: Error: invalid file or error opening file!
Select yo...</pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>interactivePlay<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font></pre></td>
<td valign="top"><pre><font color="orange"><i>Output demasiado longo: truncado</i></font>
2,37c2
< The Crown of Eternity
< [0]
< You stand at the edge of the Dark Forest, seeking the Crown of Eternity.
< + 1. Enter the forest
< + 2. Follow the river
< Select your option: [2]
< You follow the river as it winds deeper into the kingdom.
< + 9. Build a raft
< + 10. Cross a bridge ahead
< Select your option: [10]
< You find a bridge guarded by a troll demanding passage.
< + 12. Pay with gold
< + 13. Fight the troll
< Select your option: Error: invalid file or error opening file!
< Select y...</pre></td>
</tr><tr>
<td valign="top">
<a href="?inspect+/home/dshak/data/contests/AED25P1/problems/C/tests/testC12">
testC12
</a><br>
T=0.074 sec<br>
E=0 sec<br>
M=183628 Kb<br>
<font color="red">Runtime Error</font><br>
</td>
<td valign="top"><pre><font color="orange"><i>Output demasiado longo: truncado</i></font>
Debug Info: Testing interactivePlay
The Crown of Eternity
[0]
You stand at the edge of the Dark Forest, seeking the Crown of Eternity.
+ 1. Enter the forest
+ 2. Follow the river
Select your option: [1]
You step into the forest. The air is thick with mist.
+ 3. Climb a tree to scout
+ 4. Keep walking forward
Select your option: [4]
A wolf appears on the trail, growling.
+ 6. Fight the wolf
+ 7. Flee into the woods
Select your option: [7]
You escape, but drop your pack of supplies in the rush.
+ 8...</pre></td>
<td valign="top"><pre>Debug<font size="-1">[]</font>Info:<font size="-1">[]</font>Testing<font size="-1">[]</font>interactivePlay<font size="-1">\n
</font>Error:<font size="-1">[]</font>invalid<font size="-1">[]</font>file<font size="-1">[]</font>or<font size="-1">[]</font>error<font size="-1">[]</font>opening<font size="-1">[]</font>file!<font size="-1">\n
</font></pre></td>
<td valign="top"><pre><font color="orange"><i>Output demasiado longo: truncado</i></font>
2,65c2
< The Crown of Eternity
< [0]
< You stand at the edge of the Dark Forest, seeking the Crown of Eternity.
< + 1. Enter the forest
< + 2. Follow the river
< Select your option: [1]
< You step into the forest. The air is thick with mist.
< + 3. Climb a tree to scout
< + 4. Keep walking forward
< Select your option: [4]
< A wolf appears on the trail, growling.
< + 6. Fight the wolf
< + 7. Flee into the woods
< Select your option: [7]
< You escape, but drop your pack of supplies in the rush.
< ...</pre></td>
</tr></table>
<p><table>
<tr>	<th>CPU	  </th><td>0.102 (0) sec</td>	</tr>
<tr>	<th>Memory	  </th><td>184032 kbytes</td>			</tr>
<tr>	<th>Classification</th><td>Runtime Error</td>		</tr>
<tr>	<th>Mark</th>	  <td>0</td>		</tr>
<tr>
<th valign="top">Observations</th>
<td><pre></pre></td>
</tr>
<tr>
<th valign="top">Feedback</th>
<td><pre></pre></td>
</tr>

<tr>
<th>Code</th>
<td></td>
</table>
<pre>
import java.io.BufferedReader; 
import java.io.BufferedWriter;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStreamReader;
import java.lang.reflect.Field;
import java.lang.reflect.Method;
import java.util.HashMap;
import java.util.Map;

public class Story {
    // Reutilizar o mesmo BufferedReader para stdin entre invocações
    private static BufferedReader STDIN_BR = null;
    private static BufferedReader stdin() {
        if (STDIN_BR == null) {
            STDIN_BR = new BufferedReader(new InputStreamReader(System.in));
        }
        return STDIN_BR;
    }

    private final String title;
    private final Map&lt;Integer, Node&lt;Scene&gt;&gt; idToNode;
    private Node&lt;Scene&gt; current;

    // Mensagens exigidas pelo enunciado/testes
    private static final String NUMBER_FORMAT_ERROR = "Error: number format exception";
    private static final String FILE_ERROR = "Error: invalid file or error opening file!";
    private static final String SAVE_SUCCESS = "Story state saved successfully.";
    private static final String LOAD_SUCCESS = "Story state loaded successfully.";
    private static final String INVALID_LOAD_STORY_NAME = "Invalid story title in load file.";
    private static final String INVALID_LOAD_SCENE = "Invalid scene id in load file.";

    /* ========= Construtores ========= */

    // Construtor exigido pelos testes: título + array de nós
    public Story(String title, Node&lt;Scene&gt;[] nodes) {
        if (title == null || nodes == null || nodes.length == 0) {
            throw new IllegalArgumentException("Invalid Story arguments");
        }
        this.title = title;
        this.idToNode = new HashMap&lt;Integer, Node&lt;Scene&gt;&gt;();
        // current é o primeiro nó do array
        this.current = nodes[0];
        // preencher o mapa id-&gt;nó
        for (int i = 0; i &lt; nodes.length; i++) {
            Node&lt;Scene&gt; n = nodes[i];
            Scene s = nodeScene(n);
            if (s != null) {
                idToNode.put(Integer.valueOf(s.getId()), n);
            }
        }
    }

    // Construtor alternativo (mantido para compatibilidade interna)
    public Story(String title, Node&lt;Scene&gt; start, Map&lt;Integer, Node&lt;Scene&gt;&gt; idToNode) {
        if (title == null || start == null || idToNode == null) {
            throw new IllegalArgumentException("Invalid Story arguments");
        }
        this.title = title;
        this.current = start;
        this.idToNode = idToNode;
    }

    /* ========= Getters exigidos pelos testes ========= */

    public String getTitle() {
        return title;
    }

    public Node&lt;Scene&gt; getCurrent() {
        return current;
    }

    /* ========= Parsing de ficheiro para construir Story (opcional para os testes) ========= */

    public static Story parseStory(String fileName) {
        try (BufferedReader br = new BufferedReader(new FileReader(fileName))) {
            String title = br.readLine();
            if (title == null) {
                System.out.println(FILE_ERROR);
                return null;
            }
            int nScenes;
            try {
                String nLine = br.readLine();
                if (nLine == null) { System.out.println(FILE_ERROR); return null; }
                nScenes = Integer.parseInt(nLine.trim());
            } catch (NumberFormatException e) {
                System.out.println(NUMBER_FORMAT_ERROR);
                return null;
            }

            // criar arrays temporários
            @SuppressWarnings("unchecked")
            Node&lt;Scene&gt;[] nodes = (Node&lt;Scene&gt;[]) new Node&lt;?&gt;[nScenes];

            for (int i = 0; i &lt; nScenes; i++) {
                String line = br.readLine();
                if (line == null) { System.out.println(FILE_ERROR); return null; }
                line = line.trim();
                if (line.isEmpty()) { i--; continue; }

                // Formato: id;type;text;opt1Id,opt2Id,...
                String[] parts = line.split(";", -1);
                if (parts.length &lt; 3) { System.out.println(FILE_ERROR); return null; }

                int idScene;
                try {
                    idScene = Integer.parseInt(parts[0].trim());
                } catch (NumberFormatException e) {
                    System.out.println(NUMBER_FORMAT_ERROR);
                    return null;
                }

                Scene.Type type = Scene.Type.valueOf(parts[1].trim());
                String text = parts[2];

                // ORDEM CORRETA: (id, description, type)
                Scene scene = new Scene(idScene, text, type);

                Node&lt;Scene&gt; node = new Node&lt;Scene&gt;(scene);
                nodes[i] = node;

                if (parts.length &gt; 3) {
                    String opts = parts[3].trim();
                    if (!opts.isEmpty()) {
                        String[] arr = opts.split(",");
                        for (int k = 0; k &lt; arr.length; k++) {
                            String s = arr[k].trim();
                            if (s.isEmpty()) continue;
                            int targetId;
                            try {
                                targetId = Integer.parseInt(s);
                            } catch (NumberFormatException e) {
                                System.out.println(NUMBER_FORMAT_ERROR);
                                return null;
                            }
                            // Regista a Option com o id de destino; a navegação usa idToNode
                            scene.addOption(new Option(targetId, "Option " + targetId));
                        }
                    }
                }
            }

            // constrói Story usando o construtor por array (o que o teste usa)
            return new Story(title, nodes);

        } catch (NumberFormatException e) {
            System.out.println(NUMBER_FORMAT_ERROR);
            return null;
        } catch (IOException e) {
            System.out.println(FILE_ERROR);
            return null;
        }
    }

    /** Reinicia o estado para a primeira cena (menor id presente no mapa). */
    public void reset() {
        int min = Integer.MAX_VALUE;
        Node&lt;Scene&gt; first = null;
        for (Map.Entry&lt;Integer, Node&lt;Scene&gt;&gt; e : idToNode.entrySet()) {
            if (e.getKey().intValue() &lt; min) {
                min = e.getKey().intValue();
                first = e.getValue();
            }
        }
        if (first != null) current = first;
    }

    /** Modo não-interativo: lê stdin, ignora inválidos e imprime apenas o estado final. */
    public void nonInteractivePlay() {
        try { BufferedReader br = stdin();
            reset();
            String line;
            while ((line = br.readLine()) != null) {
                Scene.Type tNow = nodeScene(current).getType();
                if (tNow == Scene.Type.WON || tNow == Scene.Type.FAILED) break;

                line = line.trim();
                if (line.isEmpty()) continue;

                int choice;
                try {
                    choice = Integer.parseInt(line);
                } catch (NumberFormatException e) {
                    // ignora linha inválida
                    continue;
                }
                Node&lt;Scene&gt; next = findNextByOption(nodeScene(current), choice);
                if (next == null) {
                    // opção inexistente → ignora
                    continue;
                }
                current = next;
            }

            Scene.Type t = nodeScene(current).getType();
            if (t == Scene.Type.WON) {
                System.out.println("WON");
            } else if (t == Scene.Type.FAILED) {
                System.out.println("FAILED");
            } else {
                System.out.println("WAITING");
            }
        } catch (IOException e) {
            System.out.println("WAITING");
        }
    }

    /** Modo interativo: título + comandos + opções. */
    public void interactivePlay() {
        System.out.println(title);
        try { BufferedReader br = stdin();
            // Imprime a cena inicial
            Scene currentScene = nodeScene(current);
            System.out.println(currentScene.toString());
            if (currentScene.getType() == Scene.Type.WON || currentScene.getType() == Scene.Type.FAILED) {
                return;
            }
            while (true) {
                System.out.print("Select your option: ");
                String line = br.readLine();
                if (line == null) return;

                line = line.trim();
                if (line.isEmpty()) {
                    System.out.println("Invalid option");
                    continue;
                }

                if (line.equalsIgnoreCase("RESET")) {
                    reset();
                    System.out.println(nodeScene(current).toString());
                    if (nodeScene(current).getType() != Scene.Type.NORMAL) return;
                    continue;
                }
                if (line.equalsIgnoreCase("PRINT")) {
                    System.out.println(nodeScene(current).toString());
                    continue;
                }
                if (line.regionMatches(true, 0, "SAVE", 0, 4)) {
                    String[] parts = line.split("\\s+", 2);
                    if (parts.length &lt; 2 || parts[1].trim().isEmpty()) {
                        System.out.println(FILE_ERROR);
                        continue;
                    }
                    saveStoryState(parts[1].trim());
                    continue;
                }
                if (line.regionMatches(true, 0, "LOAD", 0, 4)) {
                    String[] parts = line.split("\\s+", 2);
                    if (parts.length &lt; 2 || parts[1].trim().isEmpty()) {
                        System.out.println(FILE_ERROR);
                        continue;
                    }
                    boolean ok = loadStoryState(parts[1].trim());
                    if (ok) {
                        System.out.println(nodeScene(current).toString());
                        if (nodeScene(current).getType() != Scene.Type.NORMAL) return;
                    }
                    continue;
                }

                int choice;
                try {
                    choice = Integer.parseInt(line);
                } catch (NumberFormatException e) {
                    System.out.println("Invalid option");
                    continue;
                }
                Node&lt;Scene&gt; next = findNextByOption(nodeScene(current), choice);
                if (next == null) {
                    System.out.println("Invalid option");
                    continue;
                }
                current = next;
                System.out.println(nodeScene(current).toString());
                Scene.Type typeNow = nodeScene(current).getType();
                if (typeNow == Scene.Type.WON || typeNow == Scene.Type.FAILED) return;
            }
        } catch (IOException e) {
            System.out.println("Error: cannot access or read from standard input");
        }
    }

    /** Guardar estado (título e id da cena atual). */
    public boolean saveStoryState(String fileName) {
        try (BufferedWriter bw = new BufferedWriter(new FileWriter(fileName))) {
            bw.write(title);
            bw.newLine();
            bw.write(Integer.toString(nodeScene(current).getId()));
            bw.newLine();
            System.out.println(SAVE_SUCCESS);
            return true;
        } catch (IOException e) {
            System.out.println(FILE_ERROR);
            return false;
        }
    }

    /** Carregar estado (validar título e id). */
    public boolean loadStoryState(String fileName) {
        try (BufferedReader br = new BufferedReader(new FileReader(fileName))) {
            String t = br.readLine();
            if (t == null || !t.equals(title)) {
                System.out.println(INVALID_LOAD_STORY_NAME);
                return false;
            }
            String idLine = br.readLine();
            if (idLine == null) {
                System.out.println(INVALID_LOAD_SCENE);
                return false;
            }
            int targetId;
            try {
                targetId = Integer.parseInt(idLine.trim());
            } catch (NumberFormatException e) {
                System.out.println(NUMBER_FORMAT_ERROR);
                return false;
            }

            Node&lt;Scene&gt; node = idToNode.get(Integer.valueOf(targetId));
            if (node == null) {
                System.out.println(INVALID_LOAD_SCENE);
                return false;
            }

            this.current = node;
            System.out.println(LOAD_SUCCESS);
            return true;
        } catch (IOException e) {
            System.out.println(FILE_ERROR);
            return false;
        }
    }

    // ======= Utilitários/reflection para Node&lt;Scene&gt; (genérico) =======

    /** Obtém o Scene guardado no Node, tentando getters/fields comuns. */
    private static Scene nodeScene(Node&lt;Scene&gt; node) {
        if (node == null) return null;
        try {
            // Tenta getters comuns
            String[] getters = new String[]{"getElement", "getValue", "getScene", "getData", "get"};
            for (int i = 0; i &lt; getters.length; i++) {
                try {
                    Method m = node.getClass().getMethod(getters[i]);
                    Object s = m.invoke(node);
                    if (s instanceof Scene) return (Scene) s;
                } catch (NoSuchMethodException ignore) {}
            }
            // Tenta fields comuns
            String[] fields = new String[]{"element", "value", "scene", "data", "obj"};
            for (int i = 0; i &lt; fields.length; i++) {
                try {
                    Field f = node.getClass().getDeclaredField(fields[i]);
                    f.setAccessible(true);
                    Object s = f.get(node);
                    if (s instanceof Scene) return (Scene) s;
                } catch (NoSuchFieldException ignore) {}
            }
        } catch (Exception ignore) { }
        throw new IllegalStateException("Cannot access Scene from Node via reflection.");
    }

    /** Procura o nó de destino correspondente à opção escolhida. */
    private Node&lt;Scene&gt; findNextByOption(Scene scene, int optionId) {
        for (Option o : scene.getOptions()) {
            if (o.getId() == optionId) {
                return idToNode.get(Integer.valueOf(optionId));
            }
        }
        return null;
    }
}

</pre>

</body>